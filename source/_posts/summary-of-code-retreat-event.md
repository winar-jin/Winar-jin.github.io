---
title: Coderetreat 活动总结
layout: post
cdn: header-on
date: 2017-11-19 20:59:30
tags:
    - 个人随笔
    - 活动总结
---

![Coderetreat](images/171119-coderetreat.png)

很荣幸能在进入公司不久就以引导者的身份参与到2017年Coderetreat的活动组织中。承蒙道长和两位经验丰富的师兄的不吝指教，在这次活动中我收获颇多。感谢ThoughtWorks给我这样的机会。


## 什么是Coderetreat
Coderetreat是一场全球性的社区活动，在每年十一月份的一个周末，全球的开发者会聚在一起进行代码操练，又称GDCR（Global Day of Coderetreat）。该活动起源于2009年CodeMash开发者大会，大会中4位厌倦了总是在工作中迫于进度压力而偷工减料编写代码的开发者们，不满足于现状发起了GDCR这项专注于软件开发技艺操练的社区活动，旨在打破工作中的压力，更加纯粹的体验编程。 在GDCR一整天的编程操练中，可以尽情操练平时在工作中无法施展的各种最佳实践——结对编程、测试驱动开发、代码重构、函数式编程...

Coderetreat的具体执行中，主要有以下几个规则：
1. 每40min为一个session循环；
2. 在每次session中，都做同样的题目：[Game of life](https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life)；
3. 每个session都要结对编程且要和不同的人结对；
4. 每次session结束后，必须要**删除代码**，无压力的编程；
5. 每次session中，都会有一个限制条件（本次活动的限制条件为*最少代码令测试变绿*、*无基本数据类型*、*无条件判断*、*无副作用方法*、*小于5行的小方法*）。

由于工作中，我们总是会遇到项目经理的牧羊鞭和遗留代码的坏味道，而不得已降低代码质量，减少代码的设计，因此在"how we code at work" 和"how we should work"之间总是存在着大大的gap，而要弥补这个gap最有效的方式就是"**practice**"。
![practice](images/171119-practice.png)

### 我眼中的Coderetreat
特别喜欢这次活动时采用的标语："无压无臭地编程"。无压、无臭，我觉得这两次词语道出了这次活动的core value。无压：没有压力，在这一天中大家放下心中一定要完成某某任务的心态，以一种更加轻松的状态面对代码；无臭：没有臭代码，工作中很多时候我们会受到交付压力的影响，迫于时间压力，有时会写出烂代码，但在这一天的编程操练中，我们要对写出的每一行代码负责，坚决抵制烂代码。

Coderetreat的官方指定题目是[Game of life](https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life)。但在我看来，游戏中的需求点只是这次活动的背景而已，这次活动更重要的是"**刻意练习**"。很喜欢道长说的："像作家、运动员和演奏家这样的手艺人，总是要花大量时间刻意进行操练。然而在软件开发领域，无论中外，同样作为手艺人的软件开发者们，却很少有机会进行编程操练。此外，平时学到的良好的编程实践，在超复杂、高耦合和充满技术债和代码腐臭的遗留系统中无法施展，从而在紧张的项目进度压力下，随着一个个疲倦的加班夜而逐渐淡出我们的记忆。"

因此，正如我在活动中强调的那样：我们要放下心中完成这个游戏的念头，更加focus在每一个session的最佳实践中，哪怕我们在一个session的40min内仅仅完成了50行代码，只要我们这50行代码完全遵循了最佳实践，是我们仔细雕琢出来的，我认为就是值的，至少这50行代码，我们大大减少了"how we code at work"和"how we should work"的之间的gap。

### Something Did Well
一天的活动结束，是感觉收获满满的，包括编程的最佳实践，当然更多的收获是作为引导者，组织者的收获。下面这张图是现在结束时收集到大家的反馈，其中分为四个部分：今天学到了什么、今天哪些技能使你感到吃惊、在今后的工作中或者下周一的工作中，你觉得自己会有什么样的改变、又何建议。
![someting do well](images/171119-paper.png)
“学到了新的语言”、
“pair 后沟通起来方便多了” 、
”学习到了TDD 的小步开发，提高了效率”、
“使用快捷键重构好酷”、
“逻辑判断原来还可以用多态来写”、
“pair 真会抢键盘啊”、
“尽早把类建立出来”、
“重视多态”
“时间过的好快，要尽快 focus 在问题上”
“PHP 有个神奇的越界检查”
“我周一要 pair”
“我也要回去试一下测试驱动”
看到了这些评价，心里还是很高兴的，因为这场活动有自己的一点贡献而高兴。

![simple design](images/171119-simpledesign.png)
上面这张图是这次活动中编程最佳实践的指导原则，也就是由Kent Beck提出的simple design，简单设计原则。包含以下四个方面：
* 测试变绿：这也是最基础的原则，至少代码要先可以用，用测试证明代码满足基本的需求，也是TDD开发的基础；
* 揭示意图：简单理解就是要语义化的命名，通过阅读代码能够理解到想要表达的意思，使代码简单易懂；
* 没有重复：考虑要进行封装，抽象，或使用设计模式，从而降低重复代码；
* 最少元素：这一条是对第三条更高的要求，在第三条没有重复的基础上，还有不要过渡设计，不要提前设计暂不需要的需求，这样会减慢当前开发，不确定需求还会带来不确定的麻烦。

活动中在这四条原则的指导下，加上每一个session的限制条件，使这次活动变得更加有意思，这些限制条件是下面几条：
* 最小代码令测试通过：TDD的核心，每次只写使现在的用例通过的代码，然后通过不断完善用例，通过测试，重构代码逐步完成最终的软件开发工作；也就是常说的“红绿重构”循环；
* 无基本数据类型：这一个限制条件主要目的是让我们对数据进行封装，比如：我们在传参数的时候，可能要一次传好几个参数，且这几个参数之间有一些互相的联系，那么这个时候，我们对这个参数进行封装，传一个对象作为参数就是一个更好的选择。因为我们可以在这个类中添加一些数据之间的逻辑，既可以使代码的实现变得简单又可以增加代码的可读性；
* 无条件判断：像if/else，switch这些条件判断，很大程度上会破坏程序的开闭原则，我们后期若要拓展程序的需求，八成要需要在添加分支判断，这也是一种不好的实践；那么能够通过什么方式减少程序中的条件判断就是值得探索的；在活动现场我举了一个例子，我觉得倒是很典型：将Cell类作为超类，由此类派生出DeadCell和LiveCell两个子类，这两个子类分别实现超类的next方法，再返回一个DeadCell或LiveCell，这样就可以减少一层分支的判断。总结起来就是，可以用**多态**来减少程序中的分支。
* 无副作用方法：就是多采用纯函数，或者叫immutable的方法；纯函数是指一个函数不依赖于且不改变外部环境的函数，纯函数的返回值只和它的输入参数相关。最简单的例子就是加法函数，接受两个数值参数，返回这两个数的和，无论放在什么环境中运行，只要像函数中传入参数1、2，都会得到返回值3。要实现immutable有一种方法，就是每一次不改变该对象，而是返回一个新对象。使我想到了React中的思想，也是immutable的思想，一个页面就像是一场电影，每一个状态都是一帧，新的一帧就是一个新的状态，而不是由修改上一帧得到的。
* 小方法（≤5行）：关于方法为什么要尽量小，我经常为别人举墙的例子：有一面墙，扒开外面的油漆，会发现一面墙是由一块一块砖砌成的。就像一个程序是由一个一个的函数组成的，函数之所以要尽量小就像砖要尽量小，只有砖足够小，才能都在什么样的建筑中都能使用，就像函数要足够小，才能够大幅度增加函数的可复用性，如果一块儿砖5米，那砖的适用性我想会大大降低吧。
![schedule](images/171119-schedule.png)

这次自己更多的承担了组织者的角色，现场并未和小伙伴们体验结对编程，这些原则和实践还只是停留在嘴边，并没有亲自操练过，在接下来这周内，要找到pair亲自操练一下Game of Life。

### 活动组织中出现的问题
活动虽然是完满的结束了，但其中还是不乏出现了很多问题，我认为很大一部分原因是我们作为引导者没有能够很好的引导大家的思考方向。

其一，由于要结对编程，且每一个session都要交换pair，因此就造成了每一个session开始时，新的pair都需要重新磨合，重新选型，搭环境等工作，很多同学反映，一个session的40min已经过了一大半了，但是还没有真正进入到需求中，还没有到限制条件出现的地方，这个session就结束了。

其二，很多同学还是不能真正的放下心中做完这个游戏的念头，还是抱着要完成这个游戏的目的在操练。最明显的就是快结束时，一位同学发言说：“都已经过了四个session了，都还没有写完这个游戏，自己感觉很失败。”这个同学的想法，在我看来已经大大的偏题了，并没有做到无压无臭的编程，谁能保证在后两个session中，这个同学没有为了做完这个游戏，而不去思考程序的设计，不去考虑session的限制条件，而写出烂代码呢。

其三，还是有很多同学以为自己来到这次编程道场中是来听我们讲课的，在结束时几个同学在提建议说道，觉得我们作为引导者讲解的太少了，并没有给出相应的demo供大家学习，觉得自己收获太少。
### 关于这些问题的思考与讨论
仔细想想，上面提到的问题，确实大部分都是我们作为引导者未能有效的引导大家而使大家导致的误解，当然还有些是Coderetreat的原则，无论怎样都是不能改变的。

每个session交换pair就是原则问题，只要我们举办的活动叫Coderetreat，就不能因为大家觉得一次session40min时间太短而不换pair，但是出现每个session的重复工作确实有我们的责任。首先我认为造成这个问题的一点原因是我们并没有将游戏的具体需求点引导的很到位，在我下面观察大家讨论的时候，每一个session开始前半段，都听到很多同学还在讨论边界算不算数，死细胞周围有两个活细胞下一轮复活么这种关于游戏需求的讨论，而迟迟没有进入代码工作，这也给我一个启示，在游戏规则的介绍中，要提前自己考虑到这些可能迷惑的地方，现场引导时提前告知同学们，并将这些规则做好规定，其实规则是没有对错的，只要我们约定好，就可以。而关于每次都要重复搭建环境这个问题，我们觉得可以使用syber-dojo这个网站提供的在线的集成环境，这样只要不同的组在网站中选择语言及框架就行，而不用自己去搭环境，可以大大减少搭环境而造成的重复时间。

关于部分同学们还是一直抱着要完成这个游戏的心态，我认为也是我们引导不到位引起的。我记得我只在开始之前，只向大家提醒过一次，这次编程活动，我们要做到无压无臭的编程，不要过度care是否能完成这个游戏，而要更加focus在程序的设计和每一次的限制条件中，但其实提醒一次远远不够，因为完成一个需求，是每一个程序员早就养成的思维方式，我觉得要每个session都提醒，且在下面观察大家写代码的时候，也要不断的看同学们是否写了反模式，要及时的对其进行提醒，使其focus在这次活动的core value中。

还有部分同学觉得来这里是上课的，其实感觉也是引导者没有突出这次活动中最有价值的是自己的pair这件事情。这次活动中，不乏有很多大牛也在其中和大家在一起编程，我们应该多引导大家向自己的每个pair学习，向他们身上学习他们写代码的习惯，他们的思维模式，那么经过一天五个session，就会和五位伙伴pair过，就相当于能吸收到五个伙伴的精华，这些才是最重要的价值呢，而不是我们作为引导者的讲解。

### 若下次组织Coderetreat如何改进
这次很幸运能够参与组织Coderetreat活动，如果明年还能参与组织该活动，我认为下面这些点可以使活动办得更加完美：
* 采用cyber-dojo网站的集成环境，而不用参加同学的自己电脑环境，以此减少搭建环境所带来的时间浪费，那么也就需要我们提前熟悉cyber-dojo网站的用法；
* 结对观察，作为观察者，有时候不能最好的观察到或者判断下面同学写的代码是否是最佳实践或者反模式，因此采用两个引导者结对观察，可以在观察中，对下面同学的代码中的细节实时轻声讨论。若为反模式，要及时提醒他们改正，若为最佳实践，在最后retro的时候要邀请那一个pair来进行分享；
* 在前面的simple design或者每个session的retro中，作为引导者一次都不要演示代码示例，减少大家以为来这里是学习的想法，多鼓励现场的小伙伴进行分享，让他们show自己的代码，让其他小伙伴意识到真正的大牛可能就是自己的pair，要多向自己的pair学习；
* 建议作为引导者的我们，应该提前做一遍这个游戏，自己要先知道大概哪个需求点会用到分支判断，可能会出现副作用，这样可以大大增加活动当天作为观察者的效率，更好的找到同学中存在的最佳实践和反模式；
* 要多提醒大家注重“刻意练习”，尽量放下心中完成游戏的想法，多focus在程序的设计上。

最后，还是很感谢ThoughtWorks能够给我这次机会参与组织Coderetreat活动，以及道长、两位师兄还有peer partner的不吝指教。

相信明年的Coderetreat会更好，也希望明年还有机会能够参与到这场活动中。🙏