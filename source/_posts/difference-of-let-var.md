---
title: JavaScriptä¸­å˜é‡çš„ä½œç”¨åŸŸå°ç»“
layout: post
cdn: header-on
date: 2017-09-26 18:23:56
tags:
    - JavaScript
---

æœ‰è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼š
```JavaScript
function count() {
    var arr = [];
    for (var i = 1; i <= 3; i++) {
        arr.push(function () {
            return i * i;
        });
    }
    return arr;
}

var results = count();
for (let j of results) {
    console.log(j());
}
```
è¿è¡Œç»“æœæ˜¯3ä¸ª16ã€‚ä½†æ˜¯æˆ‘ä»¬è‹¥å°†ä»£ç æ”¹ä¸ºè¿™æ ·å­ï¼š
```JavaScript
function bb_test() {
    let arr = [];
    for (let i = 0; i < 4; i++) {
        arr.push(function () {
            return i * i;

        });
    }
    return arr;
}

let arr = bb_test();
for (let i of arr) {
    console.log(i());
}
```
è¿è¡Œç»“æœæ˜¯0ã€1ã€4ã€9ï¼Œæ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ç»“æœã€‚
æˆ‘å°è¯•ç€å°±è¿™ä¸ªé—®é¢˜è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆç”¨`var`å’Œ`let`å¾—åˆ°ä¸åŒçš„ç»“æœã€‚
1. ç”¨`var`ï¼Œ`var`å£°æ˜çš„å˜é‡çš„ä½œç”¨åŸŸæ˜¯æ•´ä¸ªå°é—­å‡½æ•°ï¼Œæ²¡æœ‰å—çº§ä½œç”¨åŸŸã€‚
```
function count() {
    var arr = [];
    for (var i = 1; i <= 3; i++) {
        arr.push(function () {
            return i * i;
        });
    }
    return arr;
}
```
è¿™ä¸ªå‡½æ•°`count`åªæœ‰ä¸€ä¸ªä½œç”¨åŸŸï¼Œå°±æ˜¯`count`å‡½æ•°æœ¬èº«ï¼Œå› æ­¤åœ¨è¿™ä¸ªå‡½æ•°ä½œç”¨åŸŸå†…ï¼Œ`i`éƒ½ä¸ä¼šè¢«é”€æ¯ï¼Œ`i`çš„å€¼å‡å­˜åœ¨ã€‚å¦‚ä½ æ‰€è¯´ä½ è¯•äº†åœ¨å¤–ç•Œæ˜¯ä¸èƒ½è°ƒç”¨`i`çš„ï¼Œé‚£æ˜¯å› ä¸ºåœ¨å¤–ç•Œè¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œè¯¥å‡½æ•°ä½œç”¨åŸŸå°±ä¼šç»“æŸï¼Œ`i`çš„å€¼å°±ä¼šè¢«é”€æ¯ï¼Œæ‰€ä»¥æ— æ³•è°ƒç”¨`i`çš„å€¼ã€‚
ä¸ºä»€ä¹ˆè¿”å›ç»“æœæ˜¯3ä¸ª16ï¼Ÿå› ä¸ºï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä½œç”¨åŸŸå†…ï¼Œæˆ‘ä»¬æ¯ä¸€æ¬¡`push`è¿›å»çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨`count`å‡½æ•°ä¸­çš„`for`å¾ªç¯ç»“æŸåï¼Œæ­¤æ—¶`arr`æ˜¯è¿™æ ·çš„ï¼š
```
arr = [
  function () {return i * i;},
  function () {return i * i;},
  function () {return i * i;}
];
```
æ­¤æ—¶ç”±äºå‡½æ•°è¿˜æœªæ‰§è¡Œç»“æŸï¼Œä½œç”¨åŸŸè¿˜åœ¨ï¼Œ`i`çš„ä½œç”¨åŸŸè¿˜åœ¨ï¼Œå¹¶ä¸ä¼šç«‹å³ç®—å‡ºç»“æœï¼Œåœ¨`for`çš„ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œå…ˆ`i++`å¾—åˆ°`i=4`ï¼Œåˆ¤å®š`i<=3`ä¸º`false`ï¼Œæ‰€ä»¥ç»“æŸæ­¤è¿™ä¸ªå¾ªç¯ï¼ˆè¿™æ—¶åœ¨è¿™ä¸ªå‡½æ•°ä½œç”¨åŸŸå†…`i`çš„å€¼ä¸º`4`ï¼‰ï¼Œæ¥ä¸‹æ¥`return arr;`ï¼Œåœ¨`return`ä¹‹åï¼Œ`count`å‡½æ•°å°±æ‰§è¡Œå®Œæ¯•äº†ï¼Œ`count`å‡½æ•°çš„å‡½æ•°ä½œç”¨åŸŸä¹Ÿä¼šæ¶ˆå¤±ï¼Œå³`i`ä¹Ÿä¼šç«‹å³æ¶ˆå¤±ï¼Œä½†æˆ‘ä»¬å°†`arr`è¿”å›äº†ï¼Œæ‰€ä»¥`count`å‡½æ•°æ‰§è¡Œåçš„`arr`ç›¸å½“äºï¼š
```
arr = [
  function () {return 4 * 4;},
  function () {return 4 * 4;},
  function () {return 4 * 4;}
];
```
æ‰€ä»¥æˆ‘ä»¬åœ¨
```
var results = count();
for (let j of results) {
    console.log(j());
}
```
æ—¶ä¼šç›´æ¥è¿”å›`16 16 16`ã€‚
2. ç”¨`let`ï¼Œ`let`å£°æ˜çš„å˜é‡åªåœ¨å…¶å£°æ˜çš„å—æˆ–å­å—ä¸­å¯ç”¨ï¼Œå—çº§ä½œç”¨åŸŸå¯ä»¥ç†è§£ä¸º`{}`ï¼Œä¸€å¯¹å¤§æ‹¬å·ä¸­æ˜¯ä¸€ä¸ªä½œç”¨åŸŸã€‚
```
function let_test() {
    let arr = [];
    for (let i = 0; i < 4; i++) {
        arr.push(function () {
            return i * i;
        });
    }
    return arr;
}
```
è§‚å¯Ÿå‡½æ•°` let_test`ï¼Œä¼šå‘ç°è¿™é‡Œæœ‰äºŒä¸ªå—çº§ä½œç”¨åŸŸï¼Œä¸”`i`åªå­˜åœ¨äº*å—çº§ä½œç”¨åŸŸ2*ä¸‹ã€‚å¦‚ä¸‹ï¼š
```
function let_test() {
    // å—çº§ä½œç”¨åŸŸ1
    for (let i = 0; i < 4; i++) {
        // å—çº§ä½œç”¨åŸŸ2
        arr.push(function () {
            return i * i;
        });
    }
    return arr;
}
```
è€Œ`let`å£°æ˜çš„içš„ä½œç”¨åŸŸä¸ºè‡ªå·±æ‰€åœ¨çš„å—å’Œå…¶å­å—ä¸­å¯ç”¨ï¼Œä¸”æ¯ä¸€æ¬¡ç»“æŸå…¶å—çº§ä½œç”¨åŸŸå‡ä¼šæ¸…é™¤è¯¥å€¼ï¼Œå› æ­¤åœ¨æ‰§è¡Œå‡½æ•°å†…éƒ¨çš„å¾ªç¯æ—¶ï¼Œä¼šå…ˆè¿›å…¥*å—çº§ä½œç”¨åŸŸ2*ï¼Œç„¶å`push`åˆ°æ•°ç»„ã€‚æ³¨æ„ï¼Œå°±ä¸‹æ¥å°±ä¼šç¦»å¼€*å—çº§ä½œç”¨åŸŸ2*è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯äº†ï¼Œå› æ­¤åœ¨ç¦»å¼€*å—çº§ä½œç”¨åŸŸ2*çš„æ—¶å€™ï¼Œ`i`çš„å€¼ä¼šè¢«ç«‹å³ç»“ç®—å¹¶é‡Šæ”¾ã€‚æ­¤æ—¶`arr`çš„å€¼å°±ç›¸å½“äºï¼š
```
arr = [
  function () {return 0 * 0;},
  function () {return 1 * 1;},
  function () {return 2 * 2;},
  function () {return 3 * 3;}
];
```
ç„¶åå°±ä¼šå°†è¯¥æ•°ç»„è¿”å›ã€‚
æ‰€ä»¥åœ¨æ‰§è¡Œï¼š
```
let arr = let_test();
for (let i of arr) {
    console.log(i());
}
```
çš„æ—¶å€™ï¼Œå°±æ˜¯è¾“å‡º`0 1 4 9`ã€‚
ğŸ’¯
